%	analyse synapse matrix

clear all
close all
fclose('all');

NUM_EXC = 400; 
NUM_G1  = 1:100;
NUM_G2  = 100:200;
NUM_OTH = 200:400;

strEnv  =  {'stim100' 'addstdp' 'mltstdp' 'stim050' 'stim060' 'stim070' 'stim080' 'stim090'};
strData =  {'50[Hz]' '100[Hz]' '200[Hz]' '0.3[-]' '0.5[-]' '0.7[-]'};
strTest =  {'1,000[msec](same)' '2,000[msec](same)' '4,000[msec](same)'...
			'1,000[msec](diff)' '2,000[msec](diff)' '4,000[msec](diff)'...
			'wo learning' 'wo input mod' ' wo learning & input mod'};
strCmp  =  {'02' '04' '06' '08' '10' '12' '14' '16' '18' '20'};
strTrl  =  {'01' '02' '03' '04' '05' '06' '07' '08' '09' '10'};

anaEnv  = 1:8;	%Simulation environment
anaData = 1:6;	%Data number
anaTest = 1:9;  %Data-test number

dirPrnt = sprintf('./DataBase');
dirPrntSeq = sprintf('.');

for i = anaEnv
	dirEnv = sprintf('%s/%s',dirPrnt,strEnv{i});
	dirEnvSeq = sprintf('%s/mod-code-longstim02-%s',dirPrntSeq,strEnv{i});

	for j = anaData
		dirData = sprintf('%s/data%d',dirEnv,j);
		dirDataSeq = sprintf('%s/data%d',dirEnvSeq,j);

		for k = anaTest
			dirTest = sprintf('%s/test0%d',dirData,k);
			dirTestSeq = sprintf('%s/data-test0%d',dirDataSeq,k);
            fname = sprintf('%s/gtran.11',dirTestSeq); load(fname)
            syna_mat = zeros(NUM_EXC,NUM_EXC);
            for num=1:size(gtran,1)
                jj = gtran(num,1);
                ii = gtran(num,2);
                syna_mat(ii+1, jj+1) = gtran(num,3);
            end
            syna_in = mean(syna_mat,2);
            syna_out = mean(syna_mat,1);
			syna_mean(1,1) = mean(mean(syna_mat(NUM_G1,NUM_G1),1),2); 
			syna_mean(2,1) = mean(mean(syna_mat([NUM_G2 NUM_OTH],NUM_G1),1),2); 
			syna_mean(1,2) = mean(mean(syna_mat(NUM_G1,[NUM_G2 NUM_OTH]),1),2); 
			syna_mean(2,2) = mean(mean(syna_mat([NUM_G2 NUM_OTH],[NUM_G2 NUM_OTH]),1),2); 
			gbins = logspace(-2,2);
			[ns0,bins0] = hist(syna_mat(find(syna_mat)),gbins);
			syna_dist = [ns0; bins0];
			for l = 1:4
				switch l
				case 1; row=NUM_G1;clm=NUM_G1;
				case 2; row=[NUM_G2 NUM_OTH];clm=NUM_G1;
				case 3; row=NUM_G1;clm=[NUM_G2 NUM_OTH];
				case 4; row=[NUM_G2 NUM_OTH];clm=[NUM_G2 NUM_OTH];
				end
				syna_mat_tmp = syna_mat(row,clm);
				[ns00,bins00] = hist(syna_mat_tmp(find(syna_mat_tmp)),gbins);
				syna_dist_chunked{l} = [ns00;bins00];
				clear syna_mat_tmp ns00 bins00
			end
			save_str = sprintf('%s/synapse.mat',dirTest);
			save(save_str,'syna_mat','syna_in','syna_out','syna_mean','syna_dist','syna_dist_chunked');

			fprintf('For loop have finished until test0%d\n',k);
		end %for k : data-test

		fprintf('For loop have finished until data%d\n',j);
	end %for j : data

	fprintf('For loop have finished until simu env%d\n',i);
end	%for i : simulation environment
