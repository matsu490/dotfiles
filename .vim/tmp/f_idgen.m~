function [idSAEA] = f_idgen(ns,tbin,tmax,data,test)
global STIM_TIME ID_G1 ID_G2 ID_OTHER NUM_EXC

if sum(data==[1 2 3])
	row = 4;
elseif sum(data==[4 5 6])
	row = 6;
end
idSAEA = zeros(row,tmax/tbin);

if sum(test==[1 4 7 8 9])
	interval = 1000;
elseif sum(test==[2 5])
	interval = 2000;
elseif sum(test==[3 6])
	interval = 4000;
end
idBin = 1:tmax/tbin;
idBef = idBin(1,1:100000/tbin);
idAft = idBin(1,(100000+tbin)/tbin:110000/tbin);

idBef2 = reshape(idBef,interval/tbin,[]);
idBefEA = idBef2(1:STIM_TIME/tbin,:);
idBefSA = idBef2((STIM_TIME+tbin)/tbin:end,:);
idBefSA = reshape(idBefSA,[],1)';
idBefSA = [idBefEA(:,1)' idBefSA];
idBefSA = sort(idBefSA);
idBefEA(:,1) = [];
idBefEA = reshape(idBefEA,[],1)';

idAftSA = idAft;
idAftSA(:,(5000+tbin)/tbin:(5000+STIM_TIME)/tbin) = [];
idAftEA = idAft((5000+tbin)/tbin:(5000+STIM_TIME)/tbin);

if sum(data==[1 2 3])
	idSAEA(1,idBefSA) = 1;
	idSAEA(2,idBefEA) = 1;
	idSAEA(3,idAftSA) = 1;
	idSAEA(4,idAftEA) = 1;
elseif sum(data==[4 5 6])
	thr = .5;
	idBefEA1 = idBefEA(:,find(mean(ns(:,idBefEA))<thr));
	idBefEA2 = idBefEA(:,find(mean(ns(:,idBefEA))>=thr));
	idAftEA1 = idAftEA(:,find(mean(ns(:,idAftEA))<thr));
	idAftEA2 = idAftEA(:,find(mean(ns(:,idAftEA))>=thr));

	idSAEA(1,idBefSA)  = 1;
	idSAEA(2,idBefEA1) = 1;
	idSAEA(3,idBefEA2) = 1;
	idSAEA(4,idAftSA)  = 1;
	idSAEA(5,idAftEA1) = 1;
	idSAEA(6,idAftEA2) = 1;
end
